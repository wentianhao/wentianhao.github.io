---
title: 实验记录
date: 2021-05-28 16:31:37
tags:
categories:
---

模型

train

**Mulrel_ranker Model**

context_emb -> cnn -> max_pool1d

desc_emb -> cnn -> max_pool1d

sim = context_cnn * desc_cnn /(|context_cnn|*|desc_cnn|)

typing feature:

mt_emb = mtype * type_emb

et_emb = etype * type_emb

**local model**

local_ent_scores: 局部模型得分

ent_tok_att_scores = bmm(entity_vecs*att_mat_diag,tok_vecs)

tok_att_scores = max(ent_tok_att_scores)

top_tok_att_scores, top_tok_att_ids = topk(tok_att_scores)

att_probs = softmax(top_tok_att_scores)

att_probs = att_probs / sum(att_probs)

selected_tok_vecs = gather(tok_vecs,index=top_tok_att_ids)

ctx_vecs = sum(selected_tok_vecs * tok_score_mat_diag) * att_probs)

ent_ctx_scores = bmm(entity_vecs,ctx_vecs)


**DCA model**

------
实验记录
5.28
nohup python main.py --mode train --semantic --order offset --model_path model --method SL > /home/wenh/deep-dca/log/SL_semantic.log 2>&1 &

5.29

<!-- done -->

nohup python main.py --mode train --order offset --model_path model --method SL > /home/wenh/deep-dca/log/SL_nosemantic.log 2>&1 &

isDynamic: 0, isOrderFixed: True, isOrderLearning: False, isSort: topic, 


nohup python main.py --mode train --order offset --model_path model --isDynamic 1 --method SL > /home/wenh/deep-dca/log/SL_nosemantic_isD1.log 2>&1 &

nohup python main.py --mode train --order offset --model_path model --isDynamic 2 --method SL > /home/wenh/deep-dca/log/SL_nosemantic_isD2.log 2>&1 &


nohup python main.py --mode train --semantic --seq_len 50 --order offset --model_path model --method SL > /home/wenh/deep-dca/log/SL_semantic_seq_len50.log 2>&1 &

**5.30**

nohup python main.py --mode train --order offset --model_path model --isDynamic 2 --seq_len 50 --method SL > /home/wenh/deep-dca/log/SL_nosemantic_seq50_isD2.log 2>&1 &

nohup python main.py --mode train --order offset --model_path model --isDynamic 2 --seq_len 25 --method SL > /home/wenh/deep-dca/log/SL_nosemantic_seq25_isD2.log 2>&1 &

由于上下文输出没有分开，以上实验输出的均为所有上下文内容，目前已修改。


**5.29 **
local model
得分函数增加联合p（e|m）

note:
加上 seq_len 参数 5-50,此参数可有效减少模型的内存

nohup python main.py --mode train --order offset --model_path model --isDynamic 2 --seq_len 25 --method SL > /home/wenh/deep-dca/log/SL_nosemantic_seq25_isD2_1.log 2>&1 &


nohup python main.py --mode train --semantic --order offset --model_path model --method SL > /home/wenh/deep-dca/log/SL.log 2>&1 &
【29380】

**上下文：**

Extinction era coal linked to Chinese cancer epidemic EARTH Magazine Skip to main content Home SubscribeNew Subscription Renew Free Trial Digital Edition ClassifiedsCareer Opportunities Position Wanted Supplies and Services Student Opportunities Contact UsEditorial Customer Service Archive Follow Us Advertise In Print Extinction era coal linked to **Chinese** cancer epidemic The people of Xuan Wei China suffer the world s highest incidence of lung cancer among non smokers Burning coal from the Permian Triassic boundary may be to blame Credit David Large University of Nottingham Unvented household stoves in Xuan Wei have increased exposure to smoke and particulate matter during cooking and heating Women who spend more time in the home have a higher lung cancer risk than men Credit David Large University of Nottingham The multiple flood basalt flows of the Columbia River Basalt Group which erupted about 15 million years ago and covered more than 170

**问题一：**上下文存在多余的噪声信息，原因是因为爬取的时候多爬取的网页底部信息

Goh s late father Mr Goh Seng Choo in his honor The collection comprises 477 paintings in total 70 in the main gallery whereas the rest are displayed in the Founding of Singapore section of the Singapore History Gallery This is due to space constraint as many of the paintings occupy the galleries Prior to his tenure as Singapore s first Resident and Commandant William Farquhar served as Resident and Commandant of Melaka from 1803 to 1818 During this period he made several important botanical and zoological discoveries and amassed a sizable collection of natural history drawings Painted by unidentified **Chinese** artists Farquhar had commissioned these which depict the diverse flora and fauna of the Malay Peninsula to the Royal Asiatic Society of Great Britain and Ireland These 477 drawings have since found their way back to Singapore through Mr G K Goh who purchased the paintings at a Sotheby s auction held in London for 3 millon The complete set was donated to the National Museum of Singapore

**5.31 17:00**

nohup python -u -m nel.main --mode train --n_rels 3 --mulrel_type ment-norm --model_path model > /home/wenh/mulrel/log/nel.log 2>&1 &
【2852】

**23：00**

~~nohup python main.py --mode train --semantic --order offset --dca_method 1 --model_path model --method SL > /home/wenh/deep-dca/log/SL_dca1.log 2>&1 &~~
~~【46364】~~

nohup python main.py --mode train --semantic --order offset --dca_method 2 --model_path model --method SL > /home/wenh/deep-dca/log/SL_dca2.log 2>&1 &
【9754】   0


nohup python main.py --mode train --semantic --order offset --dca_method 1 --model_path model --method SL > /home/wenh/deep-dca/log/SL_dca1.log 2>&1 &
【24165】  1

**6.1**
跑一下sort为heuristic 的排序方式的方法

nohup python main.py --mode train --semantic --order offset --sort heuristic --model_path model --method SL > /home/wenh/deep-dca/log/SL_dca_h.log 2>&1 &
【22795】 Done

mulrel 验证，输出链接错的Chinese的mention上下文与昨天的进行对比。
nohup python -u -m nel.main --mode eval --model_path model > /home/wenh/mulrel/log/eval.log 2>&1 &
【44999】 Done


nohup python main.py --mode train --semantic --order offset --sort local --model_path model --method SL > /home/wenh/deep-dca/log/SL_dca_l.log 2>&1 &
【27020】

输出mention="chinese" 链接正确的上下文和之前的进行对比
nohup python -u -m nel.main --mode eval --model_path model > /home/wenh/mulrel/log/eval1.log 2>&1 &
【1315】 Done


**6.4**
nohup python -u -m nel.main --mode eval --model_path model > /home/wenh/mulrel/log/eval2.log 2>&1 &

**6.5**
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL.log 2>&1 &


**6.9**
~~nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_mulrel.log 2>&1 &~~
~~【16006】~~
报错

**6.10**
fixed bug
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_mulrel.log 2>&1 &
【31981】

nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_mulrel1.log 2>&1 &
【8446】

**6.11**
修改 dev_f1_change_lr 0.928->0.948 
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_mulrel2.log 2>&1 &
【25012】

nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_mulrel3.log 2>&1 &
【30151】

不需要semantic语义信息
nohup python main.py --mode train --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_mulrel4.log 2>&1 &
【12665】

**6.12**

全局模型不考虑dca的scores
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_mulrel5.log 2>&1 &
[1] 28903
报错


0.5*local_scores
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_mulrel6.log 2>&1 &
[2] 29021

0.3 * local_scores
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_mulrel7.log 2>&1 &
[3] 29099

0.7*local_scores
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_mulrel8.log 2>&1 &
[1] 13691

6.15总结
加入mulrel后，ace2004数据集上升到**0.901**史高，然后其他的效果有所下降0.02


------------
6.14新增实验 对 p_e_m的比率降低
在 local_ent_scores * 0.7的条件下

- p_e_m * 0.5
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_pem.log 2>&1 &
[1] 2452
- p_e_m * 0.7
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_pem1.log 2>&1 &
[2] 3180
- p_e_m * 0.3
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_pem2.log 2>&1 &
[3] 3219

小结：
p_e_m * 0.7 时，五个数据集均有提升，提升不少。可以保持对p_e_m的比率

--------------------------
6.15

尝试一： 修改lr ： 2e-4 -> 2e-3,p_e_m，local_ent_scores 不变
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_lr2e_3.log 2>&1 &
[1] 35890

尝试二： local_ent_scores、lr 不变 p_e_m *0.7 再次对比，并输出多个mention看看、

nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_pem3.log 2>&1 &
[2] 14970

尝试三：修改lr 2e-4 -> 2e-5,其他不变
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_lr2e_5.log 2>&1 &
[3] 19745

结果分析：将lr 2e-4 -> 2e-5 不可取，所有数据集均下降至少0.2，lr 2e-4 -> 2e-3 结果变化不大，均没到达最优。


**6.16**
- lr 改回2e-4，dev_f1_change_lr改回0.928，p_e_m * 0.7
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_n616.log 2>&1 &
[1] 41065

结果分析：与dev_f1_change_lr 为0.948相比，aida-A:最高提升0.02，aida-B:下降0.01-0.02，msnbc:差不多，aquaint:降低0.02，ace2004:差不多，clueweb:差不多,wikipedia:下降一点


- p_e_m 改回*1
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_n617.log 2>&1 &
[1] 12421

结果分析：

**6.18**
nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_618.log 2>&1 &
2173

nohup python main.py --mode train --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_618_1.log 2>&1 &
1354

nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_618_2.log 2>&1 &
14156

nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_618_3.log 2>&1 &
809

修改dev_f1_change_lr 0.928 -> 0.938
nohup python main.py --mode train --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_618_4.log 2>&1 &
1643

结果：提升明显，在aida-A 和aida-B上均有提升，且aida-A突破到了0.941,aida-B:0.948,


修改dev_f1_change_lr 0.938 -> 0.940
nohup python main.py --mode train --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_618_5.log 2>&1 &
3630

结果：aida-A:0.942 aida-B:0.946

nohup python main.py --mode train --semantic --order offset --n_rels 3 --mulrel_type ment-norm --model_path model --method SL > /home/wenh/deep-dca/log/SL_618_6.log 2>&1 &
19433
